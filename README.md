## Алгоритмы асимметричного шифрования


### Цель работы

Познакомиться с принципами работы протоколов рукопожатия в современных компьютерных системах


### Дополнительные задания

1. Модифицируйте код клиента и сервера так, чтобы приватный и публичный ключ хранились в текстовых файлах на диске и, таким образом, переиспользовались между запусками. 

Ключи клиента

![screenshot](images/1.png)

Публичный ключ клиента

![screenshot](images/2.png)

Приватный ключ клиента

![screenshot](images/3.png)

Ключи сервера

![screenshot](images/4.png)

Публичный ключ клиента

![screenshot](images/5.png)

Публичные и приватные ключи клиентов, которые хранятся в виде пар ключ-значение, где ключ - публичный ключ, а значение - приватный. По этому файлу осуществляется сертификация публичного ключа клиента.

![screenshot](images/6.png)

Ключи генерируются модулем keygen.py. Он создает для теста 10 рандомных ключей на стороне сервера и 1 сертифицированный ключ для клиента. Ключи вычисляются по алгоритму, описанному в основной методичке.

![screenshot](images/7.png)

Вот так работает шифрование. Уже сразу оно реализовано на FTP-сервере.

![screenshot](images/8.png)

2. Проведите рефакторинг кода клиента и сервера так, чтобы все, относящееся к генерации ключей, установлению режима шифрования, шифрованию исходящих и дешифрованию входящих сообщений было отделено от основного алгоритма обмена сообщениями.\

Для этого были реализованы два пакета. Первый содержит логику FTP-сервера и клиента, а второй - реализацию защищенного сервера.

4. Реализуйте на сервере проверку входящих сертификатов. На сервере должен храниться список разрешенных ключей. Когда клиент посылает на сервер свой публичный ключ, сервер ищет его среди разрешенных и, если такого не находит, разрывает соединение. Проверьте правильность работы не нескольких разных клиентах.

Список сертифицированных публичных ключей клиентов:

![screenshot](images/6.png)


Если публичный ключ сертифицировнный (он остался таким, каким его сгенерировал keygen.py), для клиента разворачивает FTP-сервер.


![screenshot](images/9.png)

Попробуем удалить одну цифру из публичного ключа клиента.

![screenshot](images/10.png)

Сервер нас не сертифицировал и отклонил подключение.

![screenshot](images/11.png)

У клиента выводится об этом сообщение.

![screenshot](images/12.png)

4. Модифицируйте код клиента и сервера таким образом, чтобы установление режима шифрования происходило при подключении на один порт, а основное общение - на другом порту. Номер порта можно передавать как первое зашифрованное сообщение. 

Сервер:

![screenshot](images/13.png)

Клиент:

![screenshot](images/14.png)

5. Реализуйте пул портов.

Из пула портов выбирается рандомный свободный порт и отправлятся клиенту.

![screenshot](images/15.png)

6. Модифицируйте код FTP-сервера таким образом, чтобы он поддерживал шифрование.

Клиент (ответ сервера содержит код ответа - один символ, шифруется, и pwd пользователя):

![screenshot](images/16.png)

Сервер:

![screenshot](images/17.png)
